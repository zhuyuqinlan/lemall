<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.zhuyuqinlan.lemall.business.admin.product.dao.PmsProductDao">
  <resultMap id="BaseResultMap" type="org.zhuyuqinlan.lemall.common.entity.PmsProduct">
    <!--@mbg.generated-->
    <!--@Table pms_product-->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="brand_id" jdbcType="BIGINT" property="brandId" />
    <result column="product_category_id" jdbcType="BIGINT" property="productCategoryId" />
    <result column="feight_template_id" jdbcType="BIGINT" property="feightTemplateId" />
    <result column="product_attribute_category_id" jdbcType="BIGINT" property="productAttributeCategoryId" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="pic" jdbcType="VARCHAR" property="pic" />
    <result column="product_sn" jdbcType="VARCHAR" property="productSn" />
    <result column="delete_status" jdbcType="INTEGER" property="deleteStatus" />
    <result column="publish_status" jdbcType="INTEGER" property="publishStatus" />
    <result column="new_status" jdbcType="INTEGER" property="newStatus" />
    <result column="recommand_status" jdbcType="INTEGER" property="recommandStatus" />
    <result column="verify_status" jdbcType="INTEGER" property="verifyStatus" />
    <result column="sort" jdbcType="INTEGER" property="sort" />
    <result column="sale" jdbcType="INTEGER" property="sale" />
    <result column="price" jdbcType="DECIMAL" property="price" />
    <result column="promotion_price" jdbcType="DECIMAL" property="promotionPrice" />
    <result column="gift_growth" jdbcType="INTEGER" property="giftGrowth" />
    <result column="gift_point" jdbcType="INTEGER" property="giftPoint" />
    <result column="use_point_limit" jdbcType="INTEGER" property="usePointLimit" />
    <result column="sub_title" jdbcType="VARCHAR" property="subTitle" />
    <result column="description" jdbcType="LONGVARCHAR" property="description" />
    <result column="original_price" jdbcType="DECIMAL" property="originalPrice" />
    <result column="stock" jdbcType="INTEGER" property="stock" />
    <result column="low_stock" jdbcType="INTEGER" property="lowStock" />
    <result column="unit" jdbcType="VARCHAR" property="unit" />
    <result column="weight" jdbcType="DECIMAL" property="weight" />
    <result column="preview_status" jdbcType="INTEGER" property="previewStatus" />
    <result column="service_ids" jdbcType="VARCHAR" property="serviceIds" />
    <result column="keywords" jdbcType="VARCHAR" property="keywords" />
    <result column="note" jdbcType="VARCHAR" property="note" />
    <result column="album_pics" jdbcType="VARCHAR" property="albumPics" />
    <result column="detail_title" jdbcType="VARCHAR" property="detailTitle" />
    <result column="detail_desc" jdbcType="LONGVARCHAR" property="detailDesc" />
    <result column="detail_html" jdbcType="LONGVARCHAR" property="detailHtml" />
    <result column="detail_mobile_html" jdbcType="LONGVARCHAR" property="detailMobileHtml" />
    <result column="promotion_start_time" jdbcType="TIMESTAMP" property="promotionStartTime" />
    <result column="promotion_end_time" jdbcType="TIMESTAMP" property="promotionEndTime" />
    <result column="promotion_per_limit" jdbcType="INTEGER" property="promotionPerLimit" />
    <result column="promotion_type" jdbcType="INTEGER" property="promotionType" />
    <result column="brand_name" jdbcType="VARCHAR" property="brandName" />
    <result column="product_category_name" jdbcType="VARCHAR" property="productCategoryName" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--@mbg.generated-->
    id, brand_id, product_category_id, feight_template_id, product_attribute_category_id, 
    `name`, pic, product_sn, delete_status, publish_status, new_status, recommand_status, 
    verify_status, sort, sale, price, promotion_price, gift_growth, gift_point, use_point_limit, 
    sub_title, description, original_price, stock, low_stock, unit, weight, preview_status, 
    service_ids, keywords, note, album_pics, detail_title, detail_desc, detail_html, 
    detail_mobile_html, promotion_start_time, promotion_end_time, promotion_per_limit, 
    promotion_type, brand_name, product_category_name
  </sql>
  <resultMap extends="BaseResultMap" id="ResultMapWithBLOBs" type="org.zhuyuqinlan.lemall.common.entity.PmsProduct">
    <result column="description" jdbcType="LONGVARCHAR" property="description" />
    <result column="detail_desc" jdbcType="LONGVARCHAR" property="detailDesc" />
    <result column="detail_html" jdbcType="LONGVARCHAR" property="detailHtml" />
    <result column="detail_mobile_html" jdbcType="LONGVARCHAR" property="detailMobileHtml" />
  </resultMap>

  <resultMap id="updateInfoMap" type="org.zhuyuqinlan.lemall.business.admin.product.dto.response.PmsProductParamResultResponseDTO" extends="ResultMapWithBLOBs">
    <!-- 主表额外字段 -->
    <result column="cateParentId" jdbcType="BIGINT" property="cateParentId" />

    <!-- 各子表用单独 select 查询 -->
    <collection property="productLadderList" column="{productId=id}" select="selectProductLadderByProductId"/>
    <collection property="productFullReductionList" column="{productId=id}" select="selectProductFullReductionByProductId"/>
    <collection property="memberPriceList" column="{productId=id}" select="selectMemberPriceByProductId"/>
    <collection property="skuStockList" column="{productId=id}" select="selectSkuStockByProductId"/>
    <collection property="productAttributeValueList" column="{productId=id}" select="selectProductAttributeValueByProductId"/>
    <collection property="subjectProductRelationList" column="{productId=id}" select="selectSubjectProductRelationByProductId"/>
    <collection property="prefrenceAreaProductRelationList" column="{productId=id}" select="selectPrefrenceAreaProductRelationByProductId"/>
  </resultMap>

  <!-- 主表查询（只查商品和分类） -->
  <select id="getUpdateInfo" resultMap="updateInfoMap">
    SELECT
    p.id,
    p.name,
    p.product_category_id,
    pc.parent_id AS cateParentId,
    p.price,
    p.publish_status,
    p.verify_status,
    p.weight,
    p.sort,
    p.description,
    p.detail_html
    FROM pms_product p
    LEFT JOIN pms_product_category pc ON pc.id = p.product_category_id
    WHERE p.id = #{id}
  </select>

  <!-- 各子表的查询方法 -->
  <select id="selectProductLadderByProductId" resultMap="org.zhuyuqinlan.lemall.common.mapper.PmsProductLadderMapper.BaseResultMap">
    SELECT * FROM pms_product_ladder WHERE product_id = #{productId}
  </select>

  <select id="selectProductFullReductionByProductId" resultMap="org.zhuyuqinlan.lemall.common.mapper.PmsProductFullReductionMapper.BaseResultMap">
    SELECT * FROM pms_product_full_reduction WHERE product_id = #{productId}
  </select>

  <select id="selectMemberPriceByProductId" resultMap="org.zhuyuqinlan.lemall.common.mapper.PmsMemberPriceMapper.BaseResultMap">
    SELECT * FROM pms_member_price WHERE product_id = #{productId}
  </select>

  <select id="selectSkuStockByProductId" resultMap="org.zhuyuqinlan.lemall.common.mapper.PmsSkuStockMapper.BaseResultMap">
    SELECT * FROM pms_sku_stock WHERE product_id = #{productId}
  </select>

  <select id="selectProductAttributeValueByProductId" resultMap="org.zhuyuqinlan.lemall.common.mapper.PmsProductAttributeValueMapper.BaseResultMap">
    SELECT * FROM pms_product_attribute_value WHERE product_id = #{productId}
  </select>

  <select id="selectSubjectProductRelationByProductId" resultMap="org.zhuyuqinlan.lemall.common.mapper.CmsSubjectProductRelationMapper.BaseResultMap">
    SELECT * FROM cms_subject_product_relation WHERE product_id = #{productId}
  </select>

  <select id="selectPrefrenceAreaProductRelationByProductId" resultMap="org.zhuyuqinlan.lemall.common.mapper.CmsPrefrenceAreaProductRelationMapper.BaseResultMap">
    SELECT * FROM cms_prefrence_area_product_relation WHERE product_id = #{productId}
  </select>
</mapper>